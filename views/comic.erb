<main>
  <h1 class="text-center mb-3 mt-3"><%= @comic['title'] %> </h1>
  <h3 class="text-center mb-5">作者: <%= @user['nickname'] %>@<%= @user['account'] %> </h3>
  <div class="box8">
    <h3 class="text-center mb-5">あらすじ</h3>
    <p><%= @comic['bio'] %></p>
  </div>

  <br>
  <br>

  <% @pages.each_with_index do |page, index| %>
  <div id="carouselExampleIndicators<%= index %>" class="carousel slide" data-ride="carousel">
    <div class="carousel-inner" role="listbox">
    <% if page['page_number'].to_i == 1 %>
      <div class="carousel-item active">
    <% else %>
      <div class="carousel-item">
    <% end %>
        <img class="d-block w-100" src="<%= page['imagefile'] %>" data-holder-rendered="true" style="width: 500px; height: 600px;">
      </div>
    </div>
    <a class="carousel-control-prev" href="#carouselExampleIndicators<%= index-1 %>" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselExampleIndicators<%= index+1 %>" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>
  <% end %>

  <br>
  <h3 style="text-align: center">ページ一覧</h3>

  <% if current_user?(@user) %>
  <br>
  <div class="text-center mb-5" >
    <form action="/pages/<%= @comic['id'] %>" method="POST" enctype="multipart/form-data">
    <div id="btn" class="btn btn-outline-primary" style="inline-block">画像アップロード</div>
      <input class="input-image" type="file" name="file" id="files"/>
      <input class="input-image" type="text" id="filename" placeholder="選択されていません" readonly />
      ページ番号 <input size="1" type="number", name="page_number", value="<%= find_last_page_number(@comic['id'])+1 %>" placeholder="ページ数">
      <button type="submit" class="btn btn-info">送信する</button>
    </form>
  </div>
  <% end %>

  <br>
  <br>

  <%# 画像一覧 %>
  <div class="row">
    <% @pages.each_with_index do |page,index| %>
    <div class="col-sm-6 col-md-3" style="padding-left: 50px">
      <img src='<%= page["imagefile"] %>' width="300" height="200" class="img-thumbnail" data-toggle="modal" data-target="#image_Modal<%= index %>">
      <div class="modal fade" id="image_Modal<%= index %>" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
        <div class="modal-dialog modal-lg modal-middle">
          <div class="modal-content">
            <div class="modal-body" style="margin: auto">
              <img src='<%= page["imagefile"]%>' width="600" height="400" class="aligncenter size-full wp-image-425" />
            </div>
            <div class="modal-img_footer">
              <p> page: <%= page["page_number"] %> </p>
              <button type="button" class="btn btn-success" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      page: <%= page["page_number"] %>
      <% if current_user?(@user) %>
      <div class="caption">
        <p>
          <div style="display:inline-flex">
            <form method="POST" action="/page/<%= @comic['id'] %>/<%= page['id'] %>">
              <input type="hidden" name="_method" value="DELETE">
              <button type="submit" class="btn btn-outline-danger btn-xs">削除</button>
            </form>
          </div>
        </p>
      </div>
      <% end %>
    </div>
    <% end %>
  </div>

</main>


<script type="text/javascript">
 $(function() {
     $('#files').css({
         'position': 'absolute',
         'top': '-9999px'
     }).change(function() {
         var val = $(this).val();
         var path = val.replace(/\\/g, '/');
         var match = path.lastIndexOf('/');
    $('#filename').css("display","inline-block");
         $('#filename').val(match !== -1 ? val.substring(match + 1) : val);
     });
     $('#filename').bind('keyup, keydown, keypress', function() {
         return false;
     });
     $('#filename, #btn').click(function() {
         $('#files').trigger('click');
     });
 });
</script>
